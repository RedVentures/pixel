
var express = require('express')
  , assert = require('assert')
  , app = express();


app.configure(function(){
  app.use(express.query());
});

app.get('/image', function(req, res){
  var buff = new Buffer([
    0x47,0x49, 0x46,0x38, 0x39,0x61, 0x01,0x00, 
    0x01,0x00, 0x80,0x00, 0x00,0xFF, 0xFF,0xFF,
    0x00,0x00, 0x00,0x21, 0xf9,0x04, 0x04,0x00, 
    0x00,0x00, 0x00,0x2c, 0x00,0x00, 0x00,0x00,
    0x01,0x00, 0x01,0x00, 0x00,0x02, 0x02,0x44,
    0x01,0x00, 0x3b
  ]);

  assert.equal(req.query.key1, 'value1');

  res.set({ 'Content-Type': 'image/gif' });
  res.end(buff);
});

app.get('/script', function(req, res){
  assert.equal(req.query.key2, 'value2');
  res.end();
});

app.listen(3000);